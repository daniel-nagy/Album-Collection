var albumControllers=angular.module("albumControllers",[]);albumControllers.controller("mainController",["$scope","$modal","albumResourceService",function($scope,$modal,albumResourceService){$scope.collection=albumResourceService.query(function(){console.log("Albums retrieved")},function(error){console.log(error);$scope.openErrorModal(error,"Unable to retrieve your album collection from the server.")});$scope.openErrorModal=function(error,message){var modalInstance=$modal.open({templateUrl:"modals/errorModal.html",controller:"errorController",resolve:{error:function(){return error},message:function(){return message}}})};$scope.placeholder="/images/artwork/place holder.png";$scope.orderProp="title";$scope.options=["Artist","Title","Year"];$scope.reverse=false;$scope.order=function(input){switch(input){case"Artist":$scope.orderProp="artist";$scope.reverse=!$scope.reverse;break;case"Title":$scope.orderProp="title";$scope.reverse=!$scope.reverse;break;case"Year":$scope.orderProp="year";$scope.reverse=!$scope.reverse;break;default:$scope.orderProp="title"}};$scope.songsViewOrderProp="title";$scope.sonsViewOptions=["Album","Artist","Genre","Title"];$scope.songsViewReverse=false;$scope.songsViewOrder=function(input){switch(input){case"Album":$scope.songsViewOrderProp="album";$scope.songsViewReverse=!$scope.songsViewReverse;break;case"Artist":$scope.songsViewOrderProp="artist";$scope.songsViewReverse=!$scope.songsViewReverse;break;case"Genre":$scope.songsViewOrderProp="genre";$scope.songsViewReverse=!$scope.songsViewReverse;break;case"Title":$scope.songsViewOrderProp="title";$scope.songsViewReverse=!$scope.songsViewReverse;break;default:$scope.songsViewOrderProp="title"}};$scope.collection.$promise.then(function(){var artists=[];for(i=0;i<$scope.collection.length;i++){artists.push($scope.collection[i].artist)}$scope.artists=artists.filter(function(element,position){return artists.indexOf(element)===position});var tracks=[];for(i=0;i<$scope.collection.length;i++){for(j=0;j<$scope.collection[i].tracks.length;j++){tracks.push({title:$scope.collection[i].tracks[j],album:$scope.collection[i].title,artist:$scope.collection[i].artist,genre:$scope.collection[i].genre,year:$scope.collection[i].year,artwork:$scope.collection[i].artwork})}}$scope.tracks=tracks});$scope.fitToWindow=function(windowHeight){return{position:"fixed",height:windowHeight-194+"px","overflow-y":"scroll",margin:"145px 0 0"}};$scope.viewAlbumsBy=function(artist){$scope.albumsByArtist=[];for(i=0;i<$scope.collection.length;i++){if($scope.collection[i].artist===artist){$scope.albumsByArtist.push($scope.collection[i])}}};$scope.clearAlbumsByArtist=function(){$scope.albumsByArtist=""}}]);albumControllers.controller("retrieveAlbumController",["$scope","$routeParams","albumResourceService",function($scope,$routeParams,albumResourceService){if($scope.collection.$resolved){for(i=0;i<$scope.collection.length;i++){if($scope.collection[i].title===$routeParams.albumTitle){$scope.album=$scope.collection[i]}}}else{$scope.album=albumResourceService.get({albumTitle:$routeParams.albumTitle},function(){console.log("Album retrieved")},function(error){console.log(error);$scope.openErrorModal(error,"Unable to retrieve "+$routeParams.albumTitle+" from your collection.")})}}]);albumControllers.controller("updateAlbumModalController",["$scope","$modal",function($scope,$modal){$scope.updateAlbum=function(){if($scope.isNewAlbum){$scope.album={title:"",artist:"",genre:"",tracks:[],artwork:$scope.placeholder,year:""}}var modalInstance=$modal.open({templateUrl:"modals/editAlbumModal.html",controller:"updateAlbumController",resolve:{album:function(){return $scope.album},isNewAlbum:function(){return $scope.isNewAlbum},openErrorModal:function(){return $scope.openErrorModal}}});modalInstance.result.then(function(album){if($scope.isNewAlbum){$scope.collection.push(album);var newArtist=true;for(i=0;i<$scope.artists.length;i++){if($scope.artists[i]===album.artist){newArtist=false;break}}if(newArtist){$scope.artists.push(album.artist)}if($scope.albumsByArtist&&$scope.albumsByArtist[0].artist===album.artist){$scope.viewAlbumsBy(album.artist)}for(i=0;i<album.tracks.length;i++){$scope.tracks.push({title:album.tracks[i],album:album.title,artist:album.artist,genre:album.genre,year:album.year,artwork:album.artwork})}}else{var originalTitle=$scope.album.title;var originalTracks=$scope.album.tracks;$scope.album.title=album.title;$scope.album.artist=album.artist;$scope.album.genre=album.genre;$scope.album.tracks=album.tracks;$scope.album.artwork=album.artwork;$scope.album.year=album.year;for(i=0;i<$scope.collection.length;i++){if($scope.collection[i].title===originalTitle){$scope.collection[i].title=album.title;$scope.collection[i].artist=album.artist;$scope.collection[i].genre=album.genre;$scope.collection[i].tracks=album.tracks;$scope.collection[i].artwork=album.artwork;$scope.collection[i].year=album.year;break}}for(i=0;i<album.tracks.length;i++){var notSeen=true;for(j=0;j<originalTracks.length;j++){if(originalTracks[j]===album.tracks[i]){notSeen=false;break}}if(notSeen){$scope.tracks.push({title:album.tracks[i],album:album.title,artist:album.artist,genre:album.genre,year:album.year,artwork:album.artwork})}}for(i=0;i<originalTracks.length;i++){var notSeen=true;for(j=0;j<album.tracks.length;j++){if(album.tracks[j]===originalTracks[i]){notSeen=false;break}}if(notSeen){for(k=0;k<$scope.tracks.length;k++){if($scope.tracks[k].title===originalTracks[i]){$scope.tracks.splice(k,1);break}}}}}})}}]);albumControllers.controller("updateAlbumController",["$scope","$modalInstance","album","isNewAlbum","openErrorModal","albumResourceService",function($scope,$modalInstance,album,isNewAlbum,openErrorModal,albumResourceService){$scope.modalTitle=isNewAlbum?"Add Album":"Edit Album";$scope.artwork=album.artwork;$scope.album={title:album.title,artist:album.artist,genre:album.genre,tracks:[],artwork:album.artwork,year:album.year};$scope.trackListing={tracks:[{track:""}]};for(i=0;i<album.tracks.length;i++){$scope.trackListing.tracks[i]={track:album.tracks[i]}}$scope.removeTrack=function(index){if($scope.trackListing.tracks.length===1){delete $scope.trackListing.tracks[index].track}else{for(i=index;i<$scope.trackListing.tracks.length-1;i++){$scope.trackListing.tracks[i]=$scope.trackListing.tracks[i+1]}$scope.trackListing.tracks.pop()}};$scope.addTrack=function(index){for(i=$scope.trackListing.tracks.length;i>index+1;i--){$scope.trackListing.tracks[i]=$scope.trackListing.tracks[i-1]}$scope.trackListing.tracks[index+1]={track:""}};$scope.ok=function(){$scope.loading=true;for(i=0;i<$scope.trackListing.tracks.length;i++){if($scope.trackListing.tracks[i].track){$scope.album.tracks.push($scope.trackListing.tracks[i].track)}}setTimeout(function(){if(isNewAlbum){albumResourceService.save($scope.album).$promise.then(function(){console.log("album saved");$modalInstance.close($scope.album)},function(error){console.log(error);$modalInstance.dismiss("cancel");openErrorModal(error,"Unable to save "+$scope.album.title+" to your collection.")})}else{albumResourceService.get({albumTitle:album.title},function(){albumResourceService.update({albumTitle:album.title},$scope.album).$promise.then(function(){console.log("Album updated");$modalInstance.close($scope.album)},function(error){console.log(error);$modalInstance.dismiss("cancel");openErrorModal(error,"Unable to save changes to "+$scope.album.title+".")})},function(error){console.log(error);$modalInstance.dismiss("cancel");openErrorModal(error,"Unable to save changes to "+$scope.album.title+".")})}},3e3)};$scope.cancel=function(){$modalInstance.dismiss("cancel")}}]);albumControllers.controller("removeAlbumModalController",["$scope","$modal",function($scope,$modal){$scope.removeAlbum=function(){var modalInstance=$modal.open({templateUrl:"modals/removeAlbumModal.html",controller:"removeAlbumController",resolve:{album:function(){return $scope.album},openErrorModal:function(){return $scope.openErrorModal}}});modalInstance.result.then(function(album){for(i=0;i<$scope.collection.length;i++){if($scope.collection[i].title===album.title){$scope.collection.splice(i,1);break}}var notSeen=true;for(i=0;i<$scope.collection.length;i++){if($scope.collection[i].artist===album.artist){notSeen=false;break}}if(notSeen){for(i=0;i<$scope.artists.length;i++){if($scope.artists[i]===album.artist){$scope.artists.splice(i,1)}}}if($scope.albumsByArtist&&$scope.albumsByArtist[0].artist===album.artist&&!notSeen){$scope.viewAlbumsBy(album.artist)}else if($scope.albumsByArtist&&$scope.albumsByArtist[0].artist===album.artist){$scope.clearAlbumsByArtist()}for(i=0;i<album.tracks.length;i++){for(j=0;j<$scope.tracks.length;j++){if($scope.tracks[j].title===album.tracks[i]){$scope.tracks.splice(j,1);break}}}})}}]);albumControllers.controller("removeAlbumController",["$scope","$location","$modalInstance","album","openErrorModal","albumResourceService",function($scope,$location,$modalInstance,album,openErrorModal,albumResourceService){$scope.album=album;$scope.ok=function(){$scope.loading=true;setTimeout(function(){albumResourceService.delete({albumTitle:album.title}).$promise.then(function(){$location.path("#");console.log("Album removed");$modalInstance.close(album)},function(error){console.log(error);$modalInstance.dismiss("cancel");openErrorModal(error,"Unable to remove "+album.title+" from your collection.")})},3e3)};$scope.cancel=function(){$modalInstance.dismiss("cancel")}}]);albumControllers.controller("errorController",["$scope","$modalInstance","error","message",function($scope,$modalInstance,error,message){$scope.message=message;if(error.status===0){$scope.errorMessage="Communication with the server failed."}else if(error.data.userMessage){$scope.errorMessage=error.data.userMessage}else if(error.message){$scope.errorMessage=error.message}else{$scope.errorMessage="An unknown error occurred."}$scope.cancel=function(){$modalInstance.dismiss("cancel")}}]);albumControllers.controller("artistViewController",["$scope",function($scope){$scope.getAlbums=function(){return $scope.albumsByArtist?$scope.albumsByArtist:$scope.collection};$scope.albumCount=function(){if($scope.albumsByArtist){if($scope.albumsByArtist.length===1){return $scope.albumsByArtist.length+" album"}else if($scope.albumsByArtist.length>1){return $scope.albumsByArtist.length+" albums"}}else{return $scope.collection.length+" albums"}};$scope.toggleArtistList=function(){$scope.toggled=!$scope.toggled}}]);albumControllers.controller("inputValidationController",["$scope",function($scope){$scope.keyValidate=function(key){var charecterCode=key.which?key.which:event.keyCode;if(charecterCode<48||charecterCode>57){if(key.preventDefault()){key.preventDefault()}return false}return true}}]);albumControllers.controller("fileUploadController",["$scope","fileUploadService",function($scope,fileUploadService){$scope.uploadFile=function(){fileUploadService.readAsDataURL($scope.file,$scope).then(function(result){$scope.album.artwork="/images/artwork/"+$scope.file.name;$scope.artwork=result})};$scope.$on("fileProgress",function(event,progress){$scope.progress=progress.loaded/progress.total});$scope.$on("fileLoadProcessComplete",function(){$scope.progress=0})}]);